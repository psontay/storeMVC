<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>StoreMVC - Quản lý Danh mục</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" th:href="@{/css/category-management.css}">
</head>
<body>
<div class="layout" id="app">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="brand">
            <div class="logo">SM</div>
            <div class="brand-text">StoreMVC</div>
        </div>
        <nav class="nav">
            <div class="nav-section">Quản lý</div>
            <a class="nav-item" th:href="@{/admin/dashboard}"><i class="bi bi-speedometer2"></i><span>Dashboard</span></a>
            <a class="nav-item" th:href="@{/admin/users}"><i class="bi bi-people-fill"></i><span>Quản lý người dùng</span></a>
            <a class="nav-item" th:href="@{/admin/suppliers}"><i class="bi bi-building"></i><span>Quản lý nhà cung cấp</span></a>
            <a class="nav-item" th:href="@{/admin/products}"><i class="bi bi-box-seam"></i><span>Quản lý sản phẩm</span></a>
            <a class="nav-item active" th:href="@{/admin/categories}"><i class="bi bi-tags-fill"></i><span>Quản lý danh mục</span></a>
            <a class="nav-item" th:href="@{/admin/orders}"><i class="bi bi-receipt"></i><span>Quản lý đơn hàng</span></a>
        </nav>
        <div class="sidebar-footer">
            <button id="collapseBtn" class="btn small">Thu nhỏ</button>
            <label class="switch">
                <input id="themeToggle" type="checkbox">
                <span class="slider"></span>
            </label>
        </div>
    </aside>

    <main class="main">
        <header class="topbar">
            <div class="left">
                <button id="toggleSidebar" class="icon-btn">Menu</button>
                <form th:action="@{/admin/categories}" method="get" style="display:inline;">
                    <input class="search" name="name" placeholder="Tìm danh mục..." th:value="${param.name}"/>
                </form>
            </div>
            <div class="right">
                <span th:text="${#authentication.name}">Admin</span>
            </div>
        </header>

        <section class="content">

            <!-- Thông báo -->
            <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

            <div class="actions">
                <button type="button" class="btn primary" id="createCategoryBtn">
                    <i class="bi bi-plus-lg"></i> Thêm danh mục mới
                </button>
            </div>

            <!-- FORM TẠO MỚI -->
            <div id="createCategoryCard" class="card" style="display:none;">
                <form th:action="@{/admin/categories/create}" method="post" class="form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <h3>Thêm danh mục mới</h3>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Tên danh mục <span class="req">*</span></label>
                            <input name="name" type="text" required placeholder="VD: Điện thoại, Laptop...">
                        </div>
                        <div class="form-group">
                            <label>Mô tả</label>
                            <textarea name="description" rows="3" placeholder="Mô tả ngắn về danh mục"></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">Lưu danh mục</button>
                        <button type="button" class="btn cancelBtn">Hủy</button>
                    </div>
                </form>
            </div>

            <!-- FORM SỬA -->
            <div id="editCategoryCard" th:if="${editCategory != null}" class="card">
                <form th:action="@{'/admin/categories/edit/' + ${editCategory.id}}" method="post" class="form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <h3>Chỉnh sửa danh mục</h3>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Tên danh mục</label>
                            <input name="name" type="text" th:value="${editCategory.name}" required>
                        </div>
                        <div class="form-group">
                            <label>Mô tả</label>
                            <textarea name="description" rows="3" th:text="${editCategory.description}"></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">Cập nhật</button>
                        <button type="button" class="btn" onclick="window.location.href='/admin/categories'">Hủy</button>
                    </div>
                </form>
            </div>

            <!-- BẢNG DANH SÁCH -->
            <div class="card table-card">
                <h3>Danh sách danh mục (<span th:text="${page?.totalElements} ?: 0">0</span>)</h3>
                <div class="table-wrap">
                    <table>
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Tên danh mục</th>
                            <th>Mô tả</th>
                            <th>Hành động</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="c, iter : ${page.content}">
                            <td th:text="${iter.index + 1 + (page.number * page.size)}"></td>
                            <td th:text="${c.name}"></td>
                            <td th:text="${c.description} ?: '—'"></td>
                            <td>
                                <a th:href="@{'/admin/categories/edit/' + ${c.id}}" class="btn small">Sửa</a>
                                <form th:action="@{'/admin/categories/delete/' + ${c.id}}" method="post"
                                      style="display:inline" onsubmit="return confirm('Xóa danh mục này?')">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                    <button type="submit" class="btn small danger">Xóa</button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <!-- Phân trang -->
                    <div class="pagination">
                        <a th:if="${!page.first}"
                           th:href="@{/admin/categories(page=${page.number - 1}, size=${page.size}, name=${param.name})}">Trước</a>
                        <span>Trang <strong th:text="${page.number + 1}"></strong> / <span th:text="${page.totalPages}"></span></span>
                        <a th:if="${!page.last}"
                           th:href="@{/admin/categories(page=${page.number + 1}, size=${page.size}, name=${param.name})}">Sau</a>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<script th:src="@{/js/category-management.js}" defer></script>
<script th:src="@{/js/theme.js}" defer></script>
</body>
</html>