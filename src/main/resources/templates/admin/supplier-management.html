<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>StoreMVC - Quản lý Nhà cung cấp</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" th:href="@{/css/supplier-management.css}">
</head>
<body>
<div class="layout" id="app">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="brand">
            <div class="logo">SM</div>
            <div class="brand-text">StoreMVC</div>
        </div>
        <nav class="nav">
            <div class="nav-section">Quản lý</div>
            <a class="nav-item" th:href="@{/admin/dashboard}"><i class="bi bi-speedometer2"></i><span>Dashboard</span></a>
            <a class="nav-item" th:href="@{/admin/users}"><i class="bi bi-people-fill"></i><span>Người dùng</span></a>
            <a class="nav-item" th:href="@{/admin/products}"><i class="bi bi-box-seam"></i><span>Sản phẩm</span></a>
            <a class="nav-item" th:href="@{/admin/categories}"><i class="bi bi-tags-fill"></i><span>Danh mục</span></a>
            <a class="nav-item active" th:href="@{/admin/orders}"><i class="bi bi-receipt"></i><span>Đơn hàng</span></a>
        </nav>
        <div class="sidebar-footer">
            <button id="collapseBtn" class="btn small">Thu nhỏ</button>
            <label class="switch">
                <input id="themeToggle" type="checkbox">
                <span class="slider"></span>
            </label>
        </div>
    </aside>

    <main class="main">
        <header class="topbar">
            <div class="left">
                <button id="toggleSidebar" class="icon-btn">Menu</button>
                <form th:action="@{/admin/suppliers}" method="get" style="display:inline;">
                    <input class="search" name="name" placeholder="Tìm nhà cung cấp..." th:value="${param.name}"/>
                </form>
            </div>
            <div class="right">
                <span th:text="${#authentication.name}">Admin</span>
            </div>
        </header>

        <section class="content">

            <!-- Thông báo -->
            <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

            <div class="actions">
                <button type="button" class="btn primary" id="createSupplierBtn">
                    <i class="bi bi-plus-lg"></i> Thêm nhà cung cấp mới
                </button>
            </div>

            <!-- FORM TẠO MỚI -->
            <div id="createSupplierCard" class="card" style="display:none;">
                <form th:action="@{/admin/suppliers/create}" method="post" class="form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <h3>Thêm nhà cung cấp mới</h3>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Mã nhà cung cấp <span class="req">*</span></label>
                            <input name="name" type="text" required placeholder="VD: NCC001">
                        </div>
                        <div class="form-group">
                            <label>Tên đầy đủ <span class="req">*</span></label>
                            <input name="fullName" type="text" required>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Email <span class="req">*</span></label>
                            <input name="email" type="email" required>
                        </div>
                        <div class="form-group">
                            <label>Điện thoại <span class="req">*</span></label>
                            <input name="telPhone" type="text" required>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">Lưu nhà cung cấp</button>
                        <button type="button" class="btn cancelBtn">Hủy</button>
                    </div>
                </form>
            </div>

            <!-- FORM SỬA -->
            <div id="editSupplierCard" th:if="${editSupplier != null}" class="card">
                <form th:action="@{'/admin/suppliers/edit/' + ${editSupplier.id}}" method="post" class="form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <h3>Chỉnh sửa nhà cung cấp</h3>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Mã nhà cung cấp</label>
                            <input name="name" type="text" th:value="${editSupplier.name}" required>
                        </div>
                        <div class="form-group">
                            <label>Tên đầy đủ</label>
                            <input name="fullName" type="text" th:value="${editSupplier.fullName}" required>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Email</label>
                            <input name="email" type="email" th:value="${editSupplier.email}" required>
                        </div>
                        <div class="form-group">
                            <label>Điện thoại</label>
                            <input name="telPhone" type="text" th:value="${editSupplier.telPhone}" required>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">Cập nhật</button>
                        <button type="button" class="btn" onclick="window.location.href='/admin/suppliers'">Hủy</button>
                    </div>
                </form>
            </div>

            <!-- BẢNG DANH SÁCH -->
            <div class="card table-card">
                <h3>Danh sách nhà cung cấp (<span th:text="${page.totalElements}">0</span>)</h3>
                <div class="table-wrap">
                    <table>
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Mã NCC</th>
                            <th>Tên đầy đủ</th>
                            <th>Email</th>
                            <th>Điện thoại</th>
                            <th>Hành động</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="s, iter : ${page.content}">
                            <td th:text="${iter.index + 1 + (page.number * page.size)}"></td>
                            <td th:text="${s.name}"></td>
                            <td th:text="${s.fullName}"></td>
                            <td th:text="${s.email}"></td>
                            <td th:text="${s.telPhone}"></td>
                            <td>
                                <a th:href="@{'/admin/suppliers/edit/' + ${s.id}}" class="btn small">Sửa</a>
                                <form th:action="@{'/admin/suppliers/delete/' + ${s.id}}" method="post"
                                      style="display:inline" onsubmit="return confirm('Xóa nhà cung cấp này?')">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                    <button type="submit" class="btn small danger">Xóa</button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <!-- Phân trang -->
                    <div class="pagination">
                        <a th:if="${!page.first}"
                           th:href="@{/admin/suppliers(page=${page.number - 1}, size=${page.size}, name=${param.name})}">Trước</a>
                        <span>Trang <strong th:text="${page.number + 1}"></strong> / <span th:text="${page.totalPages}"></span></span>
                        <a th:if="${!page.last}"
                           th:href="@{/admin/suppliers(page=${page.number + 1}, size=${page.size}, name=${param.name})}">Sau</a>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<script th:src="@{/js/supplier-management.js}" defer></script>
<script th:src="@{/js/theme.js}" defer></script>
</body>
</html>